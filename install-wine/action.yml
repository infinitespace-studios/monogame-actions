name: 'Install Wine'
description: 'Installs wine on the githib action bot.'
author: 'infinitespace-studios'
inputs:
  wineprefix:
    description: 'The prefix to use for wine'
    required: false
    default: '$HOME/.winemonogame'
runs:
  using: "composite"
  steps:
    - name: Install Wine Dependencies for MacOS
      if: runner.os == 'macOS'
      run: |
        brew install libpng libjpeg libtiff
        brew install --cask xquartz wine-stable
        xattr -dr com.apple.quarantine "/Applications/Wine Stable.app"
        wine --version
        which wine
        wget -qO- https://monogame.net/downloads/net9_mgfxc_wine_setup.sh | bash
        export WINEPREFIX=${{ inputs.wineprefix }}
        wine dotnet --info
      shell: bash
    - name: Install Wine Dependencies for Linux
      if: runner.os == 'Linux'
      run: |
        sudo apt install p7zip-full curl
        sudo dpkg --add-architecture i386 
        sudo mkdir -pm755 /etc/apt/keyrings
        sudo wget -O /etc/apt/keyrings/winehq-archive.key https://dl.winehq.org/wine-builds/winehq.key
        sudo wget -NP /etc/apt/sources.list.d/ https://dl.winehq.org/wine-builds/ubuntu/dists/jammy/winehq-jammy.sources
        sudo apt update && sudo apt install --install-recommends winehq-stable
        echo "ttf-mscorefonts-installer msttcorefonts/accepted-mscorefonts-eula select true" | sudo debconf-set-selections
        sudo apt install -y ttf-mscorefonts-installer
        sudo fc-cache
        fc-match Arial
        wine --version
        which wine
        wget -qO- https://monogame.net/downloads/net9_mgfxc_wine_setup.sh | bash
        export WINEPREFIX=${{ inputs.wineprefix }}
        wine dotnet --info
      shell: bash
